<ol class="breadcrumb newcrumb">
    <li><a href="#!/"><span><i class="fa fontello-home-outline"></i></span>主页</a></li>
    <li class="active"><a href="#!/WxMenu/wxMenu">生成微信菜单</a></li>
</ol>
<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">生成微信菜单</h3>
            </div>
            <div class="box-mgr red">
                为保障用户体验，微信公众平台严禁恶意营销以及诱导分享朋友圈，严禁发布色情低俗、暴力血腥、政治谣言等各类违反法律法规及相关政策规定的信息。一旦发现，我们将严厉打击和处理。
            </div>
            <div class="box-mgr1">
                <form class="form-inline">
                    <div class="form-group mr20">
                        <label>发送平台</label>
                        <select id="isWx" class="form-control">
                            <option value="1">微信</option>
                            <option value="2">支付宝</option>
                        </select>
                    </div>
                    <div class="form-group mr20">
                        <label>群发对象</label>
                        <select id="groupId" class="form-control">
                            <option value="" selected="selected">全部用户</option>
                        </select>
                    </div>
                    <div class="form-group mr20">
                        <label>性别</label>
                        <select id="sex" class="form-control">
                            <option value="0">全部</option>
                            <option value="1">男</option>
                            <option value="2">女</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success pull-right">确认发送</button>
                </form>
            </div>

            <div class="box-body">
                <div>

                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">文字</a></li>
                        <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">图片</a></li>
                        <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">图文</a></li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="home">
                            <div class="well textArea">
                                <form role="form" class="ng-pristine ng-valid emotion-editor" id="msgSender">
                                    <div class="form-group  emotion-editor-textarea">
                                        <textarea style="width:100%" placeholder="Comment" rows="5" class="form-update" id="emotion-editor-textarea"></textarea>
                                    </div>
                                    <div class="editor-toolbar"><a class="icon-emotion emotion-switch">表情</a>
                                        <p class="editor-tip js-editorTip">还可以输入<em>600</em>字</p>
                                        <div class="emotions-wrap" style="display:none">
                                            <ul class="emotions"></ul>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="profile">

                        </div>
                        <div role="tabpanel" class="tab-pane" id="messages">

                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    textAreaCount("#emotion-editor-textarea",".editor-tip em");

    var faceimg = '';
    $("#msgSender .emotion-switch").click(function(){
        //创建表情框
        if(!faceimg){
            var emotions = [{cname:"微笑"},{cname:"撇嘴"},{cname:"色"},{cname:"发呆"},{cname:"得意"},{cname:"流泪"},{cname:"害羞"},{cname:"闭嘴"},{cname:"睡"},{cname:"大哭"},{cname:"尴尬"},{cname:"发怒"},{cname:"调皮"},{cname:"呲牙"},{cname:"惊讶"},{cname:"难过"},{cname:"酷"},{cname:"冷汗"},{cname:"抓狂"},{cname:"吐"},{cname:"偷笑"},{cname:"可爱"},{cname:"白眼"},{cname:"傲慢"},{cname:"饥饿"},{cname:"困"},{cname:"惊恐"},{cname:"流汗"},{cname:"憨笑"},{cname:"大兵"},{cname:"奋斗"},{cname:"咒骂"},{cname:"疑问"},{cname:"嘘"},{cname:"晕"},{cname:"折磨"},{cname:"衰"},{cname:"骷髅"},{cname:"敲打"},{cname:"再见"},{cname:"擦汗"},{cname:"抠鼻"},{cname:"鼓掌"},{cname:"糗大了"},{cname:"坏笑"},{cname:"左哼哼"},{cname:"右哼哼"},{cname:"哈欠"},{cname:"鄙视"},{cname:"委屈"},{cname:"快哭了"},{cname:"阴险"},{cname:"亲亲"},{cname:"吓"},{cname:"可怜"},{cname:"菜刀"},{cname:"西瓜"},{cname:"啤酒"},{cname:"篮球"},{cname:"乒乓"},{cname:"咖啡"},{cname:"饭"},{cname:"猪头"},{cname:"玫瑰"},{cname:"凋谢"},{cname:"示爱"},{cname:"爱心"},{cname:"心碎"},{cname:"蛋糕"},{cname:"闪电"},{cname:"炸弹"},{cname:"刀"},{cname:"足球"},{cname:"瓢虫"},{cname:"便便"},{cname:"月亮"},{cname:"太阳"},{cname:"礼物"},{cname:"拥抱"},{cname:"强"},{cname:"弱"},{cname:"握手"},{cname:"胜利"},{cname:"抱拳"},{cname:"勾引"},{cname:"拳头"},{cname:"差劲"},{cname:"爱你"},{cname:"NO"},{cname:"OK"},{cname:"爱情"},{cname:"飞吻"},{cname:"跳跳"},{cname:"发抖"},{cname:"怄火"},{cname:"转圈"},{cname:"磕头"},{cname:"回头"},{cname:"跳绳"},{cname:"挥手"},{cname:"激动"},{cname:"街舞"},{cname:"献吻"},{cname:"左太极"},{cname:"右太极"}];
            for(i=1;i<61;i++) faceimg+='<li><a href="javascript:void(0)"><img src="img/qq/'+i+'.gif" title="'+emotions[i-1].cname+'"/></a></li>';
            $("#msgSender .emotions").append(faceimg).find("li img").off().click(function(){
                $("#emotion-editor-textarea").off().insertContent("["+$(this).attr("title")+"]");
            });//创建完成后先将其隐藏
        }
        $(".emotions-wrap").toggle();

        $(document).bind("click",function(e){
            var target = $(e.target);
            if(target.closest(".emotions-wrap").length==1 || target.closest(".emotion-switch").length==1){
                e.stopPropagation();
            }else if(!target.closest(".emotions-wrap").length){
                $(".emotions-wrap").hide();
                $(document).unbind("click");
            }
        });
    });

    function initEditorTextArea(){
        $("#emotion-editor-textarea").val("");
        $(".editor-tip em").html(60);
    }
    // 设置消息类型
    function setMsgtype(obj,msgtype){
        $("#msgtype").val(msgtype);
        var $this = $(obj).parent();
        var index = 0;
        switch(msgtype){
            case 'image': index = 1;initEditorTextArea();$(".appmsgArea").empty(); break;
            case 'mpnews': index = 2;initEditorTextArea(); $(".imgArea").empty();break;
            default:index = 0; break;
        }

        $this.siblings().removeClass("selected");
        $this.addClass("selected");
        $(".tab-panel .tab-content").hide().eq(index).show();
    }

    // 群发消息
    function sendOutGroupManage() {
        var url = "mp/sendOutMobileMessageRpc/",
            msgtype = $("#msgtype").val(),
            param = "",
            isWx= $("#isWx").val(),
            groupId = $("#groupId").val(),
            // privice= $("#privice").val(),
            sex = $("#sex").val(),
            params = '&isWx='+isWx+'&groupId='+groupId+'&sex='+ sex;

        if(msgtype == 'text'){
            url = url + 'sendOutTextGroupMessage.do';
            var textValue = $("#emotion-editor-textarea").val();
            if(!textValue){alertMsg.error("请填写文字框的内容");return false;}
            param = 'content='+textValue+params;
        }else if(msgtype == 'image'){
            url = url + 'sendOutImageGroupMessage.do';
            var textValue = $("#wxImgUl li").attr("rel");
            if(!textValue){alertMsg.error("请上传图片");return false;}
            param = 'pid='+textValue+params;
        }else if(msgtype == 'mpnews'){
            url = url + 'sendOutNewsGroupMessage.do';
            var textValue = $("#active .appmsgArea").attr("activeArticleid");
            if(!textValue){alertMsg.error("请选择合适的图文信息");return false;}
            param = 'activeArticleid='+textValue+params;
        }else{
            alertMsg.error("类型错误！");
            return false;
        }

        $.ajax({
            url: url,
            type: "POST",
            data: param,
            async: true,
            dataType: "json",
            success: function(res){
                if(res.success){
                    var dialog = art.dialog({
                        title: '提示',
                        content: res.msg,
                        icon: 'error',
                        ok: function(){
                            dialog.close()
                        }
                    });
                }else{
                    var dialog = art.dialog({
                        title: '提示',
                        content: res.msg,
                        icon: 'error',
                        ok: function(){
                            dialog.close()
                        }
                    });
                }
            },
            error:function (res) {
                var dialog = art.dialog({
                    title: '错误',
                    content: res.msg || '网络连接失败',
                    icon: 'error',
                    ok: function(){
                        dialog.close()
                    }
                });
            }
        });
    }
</script>